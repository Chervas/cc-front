<div class="flex min-w-0 flex-auto flex-col">
	<!-- Header -->
    <div class="bg-card">
        <div class="mx-auto flex w-full max-w-screen-xl flex-col px-6 sm:px-8">
			<div class="my-8 flex min-w-0 flex-auto flex-col sm:my-12 sm:flex-row sm:items-center">
				<!-- Avatar and name -->
				<div class="flex min-w-0 flex-auto items-center">
					<div class="h-16 w-16 flex-0 overflow-hidden rounded-full">
						<img
							class="h-full w-full object-cover"
							src="assets/images/avatars/brian-hughes.jpg"
							alt="Avatar" />
					</div>
					<div class="ml-4 flex min-w-0 flex-col">
						<div class="truncate text-2xl font-semibold leading-7 tracking-tight md:text-5xl md:leading-snug">
							Hola, Carlos Hervasss
						</div>
						<div class="flex items-center">
							<mat-icon
								class="icon-size-5"
								[svgIcon]="'heroicons_solid:bell'"></mat-icon>
                        <div class="text-secondary ml-1.5 truncate leading-6">
                            Tienes 5 notificaciones y 3 tareas por hacer
                        </div>
                    </div>
                </div>
            </div>
            <!-- Actions (same row on >=sm) -->
            <div class="mt-6 flex items-center space-x-3 sm:ml-2 sm:mt-0">
                <button
                    class="bg-accent"
                    mat-flat-button
                    [color]="'accent'">
                    <mat-icon
                        class="icon-size-5"
                        [svgIcon]="'heroicons_solid:cog-8-tooth'"></mat-icon>
                    <span class="ml-2">Configuración</span>
                </button>
                <button mat-flat-button [color]="'primary'" (click)="refreshMetricas()">
                <mat-icon
                    class="icon-size-5"
                    [svgIcon]="'heroicons_solid:arrow-path'"></mat-icon>
                <span class="ml-2">Actualizar</span>
                </button>
            </div>
        </div>
        <!-- Clinic display — simplified like your example (static) -->
        <div class="flex items-center">
            <div class="overflow-hidden">
                <div class="bg-default relative flex cursor-default self-start overflow-hidden rounded-t-xl border border-b-0 pb-1 pl-5 pr-4 pt-3 truncate font-medium leading-6 text-base sm:text-lg"
                     style="padding-top:0.3rem;border-radius:10px 10px 0 0;bottom:-1px;">
                    {{ selectedClinicaDisplay }}
                </div>
            </div>
        </div>
    </div>
	<!-- Main -->
	<div class="bg-default -mt-px flex-auto border-t pt-4 sm:pt-6">
        <div class="mx-auto w-full max-w-screen-xl">
			<!-- Pestañas principales -->
			<mat-tab-group
			class="sm:px-2"
			[animationDuration]="'0'"
			mat-stretch-tabs="false"
            (selectedTabChange)="onTabChange($event.index)"
            [selectedIndex]="currentTabIndex">
			
			<!-- Pestaña Resumen -->
			<mat-tab label="Resumen">
				<ng-template matTabContent>
                    <div class="grid gap-8 pt-6 sm:gap-8 sm:pt-8">
						<div class="flex flex-col items-center justify-center p-16 text-center">
							<mat-icon
								class="icon-size-16 text-hint mb-4"
								[svgIcon]="'heroicons_outline:chart-bar'"></mat-icon>
							<div class="text-2xl font-semibold tracking-tight">
								Panel de Resumen
							</div>
							<div class="text-secondary mt-2">
								Aquí aparecerán las métricas generales de tu clínica
							</div>
						</div>
					</div>
				</ng-template>
			</mat-tab>
			
			<!-- Pestaña Redes Sociales -->
            <mat-tab label="Redes Sociales">
				<ng-template matTabContent>
                    <div class="grid gap-8 pt-6 sm:gap-8 sm:pt-8">
						<!-- Título de sección -->
						<div>
							<!-- NUEVA SECCIÓN: 3 Gráficas Superiores de Evolución -->
							<div *ngIf="!loadingMetricas">
								<!-- Selector de tiempo global -->
                                <div class="flex items-center justify-between mb-6">
                                    <div>
                                        <div class="text-2xl font-semibold tracking-tight">Seguidores</div>
                                        <div class="text-secondary">Evolución seguidores en tus redes</div>
                                        <!-- CTA de conexión si no hay ninguna red vinculada -->
                                        <div *ngIf="!vinculaciones.instagram && !vinculaciones.facebook" class="mt-4 p-4 rounded-xl border border-dashed border-gray-300 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/40">
                                            <div class="text-sm mb-3">No has vinculado redes sociales aún con esta clínica.</div>
                                            <div class="flex items-center space-x-3">
                                                <button mat-flat-button color="primary" (click)="openAssetMappingDialog()">
                                                    <mat-icon class="mr-2" [svgIcon]="'heroicons_outline:link'"></mat-icon>
                                                    Conectar con Meta
                                                </button>
                                                <button mat-stroked-button disabled class="opacity-60">
                                                    Conectar con TikTok
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="ml-2 flex items-center space-x-3">
                                        <button mat-stroked-button [matMenuTriggerFor]="menuRangoGlobal">{{ analyticsStart | date:'d/M/yyyy' }} - {{ analyticsEnd | date:'d/M/yyyy' }}</button>
                                        <mat-menu #menuRangoGlobal="matMenu">
                                            <button mat-menu-item (click)="setQuickRange('yesterday')">Ayer</button>
                                            <button mat-menu-item (click)="setQuickRange('last7')">Última semana</button>
                                            <button mat-menu-item (click)="setQuickRange('last30')">Último mes</button>
                                            <button mat-menu-item (click)="setQuickRange('thisYear')">Este año</button>
                                            <button mat-menu-item (click)="setQuickRange('lastYear')">El año pasado</button>
                                            <button mat-menu-item (click)="setQuickRange('all')">Desde siempre</button>
                                            <mat-divider></mat-divider>
                                            <button mat-menu-item (click)="openCustomRangeDialog()">Personalizado…</button>
                                        </mat-menu>
                                        <!-- Rango personalizado ahora se selecciona en un diálogo -->
                                    </div>
                                </div>

								<!-- Grid de 3 gráficas superiores -->
                                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-12">
                                    
                                    <!-- Gráfica Instagram -->
                                    <div class="bg-card dark flex flex-auto flex-col overflow-hidden rounded-2xl shadow">
                                        <div class="ml-6 mr-6 mt-6 flex items-center justify-between">
                                            <div class="flex flex-col">
                                                <div class="text-xl font-semibold leading-7 tracking-tight text-pink-400">
                                                    Instagram
                                                </div>
                                                <div class="text-secondary font-medium">
                                                    <ng-container *ngIf="vinculaciones.instagram; else igNoLinked">
                                                        {{ getGrowthPercentage('instagram') }}% crecimiento
                                                    </ng-container>
                                                    <ng-template #igNoLinked>
                                                        No se ha vinculado aún Instagram con {{ selectedClinicaDisplay }}
                                                    </ng-template>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="flex h-80 flex-auto flex-col">
                                            <apx-chart *ngIf="datosCargados"
                                                #instagramOverviewChart
                                                class="h-full w-full flex-auto"
                                                [chart]="chartInstagramOverview.chart"
                                                [colors]="chartInstagramOverview.colors"
                                                [dataLabels]="chartInstagramOverview.dataLabels"
                                                [fill]="chartInstagramOverview.fill"
                                                [grid]="chartInstagramOverview.grid"
                                                [series]="chartInstagramOverview.series"
                                                [stroke]="chartInstagramOverview.stroke"
                                                [tooltip]="chartInstagramOverview.tooltip"
                                                [xaxis]="chartInstagramOverview.xaxis"
                                                [yaxis]="chartInstagramOverview.yaxis">
                                            </apx-chart>
                                        </div>
                                    </div>

                                    <!-- Gráfica TikTok -->
                                    <div class="bg-card dark flex flex-auto flex-col overflow-hidden rounded-2xl shadow">
                                        <div class="ml-6 mr-6 mt-6 flex items-center justify-between">
                                            <div class="flex flex-col">
                                                <div class="text-xl font-semibold leading-7 tracking-tight text-cyan-400">
                                                    TikTok
                                                </div>
                                                <div class="text-secondary font-medium">
                                                    {{ getGrowthPercentage('tiktok') }}% crecimiento
                                                </div>
                                            </div>
                                        </div>
                                        <div class="flex h-80 flex-auto flex-col">
                                            <apx-chart *ngIf="datosCargados"
                                                #tiktokOverviewChart
                                                class="h-full w-full flex-auto"
                                                [chart]="chartTiktokOverview.chart"
                                                [colors]="chartTiktokOverview.colors"
                                                [dataLabels]="chartTiktokOverview.dataLabels"
                                                [fill]="chartTiktokOverview.fill"
                                                [grid]="chartTiktokOverview.grid"
                                                [series]="chartTiktokOverview.series"
                                                [stroke]="chartTiktokOverview.stroke"
                                                [tooltip]="chartTiktokOverview.tooltip"
                                                [xaxis]="chartTiktokOverview.xaxis"
                                                [yaxis]="chartTiktokOverview.yaxis">
                                            </apx-chart>
                                        </div>
                                    </div>

                                    <!-- Gráfica Facebook -->
                                    <div class="bg-card dark flex flex-auto flex-col overflow-hidden rounded-2xl shadow">
                                        <div class="ml-6 mr-6 mt-6 flex items-center justify-between">
                                            <div class="flex flex-col">
                                                 <div class="text-xl font-semibold leading-7 tracking-tight text-cyan-400">
                                                    Facebook
                                                </div>
                                                <div class="text-secondary font-medium">
                                                    <ng-container *ngIf="vinculaciones.facebook; else fbNoLinked">
                                                        {{ getGrowthPercentage('facebook') }}% crecimiento
                                                    </ng-container>
                                                    <ng-template #fbNoLinked>
                                                        No se ha vinculado aún Facebook con {{ selectedClinicaDisplay }}
                                                    </ng-template>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="flex h-80 flex-auto flex-col">
                                            <apx-chart *ngIf="datosCargados"
                                                #facebookOverviewChart
                                                class="h-full w-full flex-auto"
                                                [chart]="chartFacebookOverview.chart"
                                                [colors]="chartFacebookOverview.colors"
                                                [dataLabels]="chartFacebookOverview.dataLabels"
                                                [fill]="chartFacebookOverview.fill"
                                                [grid]="chartFacebookOverview.grid"
                                                [series]="chartFacebookOverview.series"
                                                [stroke]="chartFacebookOverview.stroke"
                                                [tooltip]="chartFacebookOverview.tooltip"
                                                [xaxis]="chartFacebookOverview.xaxis"
                                                [yaxis]="chartFacebookOverview.yaxis">
                                            </apx-chart>
                                        </div>
                                    </div>
                                </div>
							</div>
						</div>

                        <!-- ======================== -->
                        <!-- Bloque Analytics (Fuse)  -->
                        <!-- ======================== -->
                        <div class="mt-10">
                            <div class="flex items-center justify-between mb-6">
                                <div>
                                    <div class="text-2xl font-semibold tracking-tight">Estadísticas</div>
                                    <div class="text-secondary">Análisis general</div>
                                </div>
                                <!-- Selector de plataforma -->
                                <mat-button-toggle-group [value]="analyticsPlatform" (change)="onAnalyticsPlatformChange($event.value)" class="platform-toggle-group space-x-1 border-none">
                                    <mat-button-toggle class="overflow-hidden rounded-full border-none px-3 font-medium flex items-center" value="instagram">
                                        <mat-icon class="mr-2" [svgIcon]="'feather:instagram'"></mat-icon>
                                        <span>Instagram</span>
                                    </mat-button-toggle>
                                    <mat-button-toggle class="overflow-hidden rounded-full border-none px-3 font-medium flex items-center" value="facebook">
                                        <mat-icon class="mr-2" [svgIcon]="'feather:facebook'"></mat-icon>
                                        <span>Facebook</span>
                                    </mat-button-toggle>
                                    <mat-button-toggle class="overflow-hidden rounded-full border-none px-3 font-medium flex items-center" value="tiktok">
                                        <mat-icon class="mr-2" [svgIcon]="'feather:music'"></mat-icon>
                                        <span>TikTok</span>
                                    </mat-button-toggle>
                                </mat-button-toggle-group>
                                <!-- (Se usa el date range superior; no duplicar) -->
                            </div>

                            <!-- KPIs estilo Fuse con deltas -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                                <!-- Alcance total -->
                                <div class="bg-card rounded-2xl shadow overflow-hidden">
                                    <div class="p-6 pb-2">
                                        <div class="text-secondary mb-2">Alcance total</div>
        								<div class="flex items-baseline space-x-3">
                                            <div class="text-4xl font-bold">{{ formatNumber(kpiReachTotal || 0) }}</div>
                                            <div class="text-sm font-medium" [ngClass]="{
                                                'text-green-600': (kpiReachDeltaPct ?? 0) > 0,
                                                'text-red-600': (kpiReachDeltaPct ?? 0) < 0,
                                                'text-secondary': (kpiReachDeltaPct ?? 0) === 0 || kpiReachDeltaPct === null
                                            }">
                                                <span *ngIf="kpiReachDeltaPct !== null">{{ kpiReachDeltaPct > 0 ? '+' : ''}}{{ kpiReachDeltaPct }}%</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="px-0 pb-0">
                                        <apx-chart [chart]="chartKpiReach.chart" [series]="chartKpiReach.series" [colors]="chartKpiReach.colors" [stroke]="chartKpiReach.stroke"></apx-chart>
                                    </div>
                                </div>
                                <!-- Interacciones totales -->
                                <div class="bg-card rounded-2xl shadow overflow-hidden">
                                    <div class="p-6 pb-2">
                                        <div class="text-secondary mb-2">Interacciones totales</div>
        								<div class="flex items-baseline space-x-3">
                                            <div class="text-4xl font-bold">{{ formatNumber(kpiEngagementTotal || 0) }}</div>
                                            <div class="text-sm font-medium" [ngClass]="{
                                                'text-green-600': (kpiEngagementDeltaPct ?? 0) > 0,
                                                'text-red-600': (kpiEngagementDeltaPct ?? 0) < 0,
                                                'text-secondary': (kpiEngagementDeltaPct ?? 0) === 0 || kpiEngagementDeltaPct === null
                                            }">
                                                <span *ngIf="kpiEngagementDeltaPct !== null">{{ kpiEngagementDeltaPct > 0 ? '+' : ''}}{{ kpiEngagementDeltaPct }}%</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="px-0 pb-0">
                                        <apx-chart [chart]="chartKpiEngagement.chart" [series]="chartKpiEngagement.series" [colors]="chartKpiEngagement.colors" [stroke]="chartKpiEngagement.stroke"></apx-chart>
                                    </div>
                                </div>
                                <!-- Nuevos seguidores -->
                                <div class="bg-card rounded-2xl shadow overflow-hidden">
                                    <div class="p-6 pb-2">
                                        <div class="text-secondary mb-2">Nuevos seguidores</div>
        								<div class="flex items-baseline space-x-3">
                                            <div class="text-4xl font-bold">{{ formatNumber(kpiNewFollowers || 0) }}</div>
                                            <div class="text-sm font-medium" [ngClass]="{
                                                'text-green-600': (kpiNewFollowersDeltaPct ?? 0) > 0,
                                                'text-red-600': (kpiNewFollowersDeltaPct ?? 0) < 0,
                                                'text-secondary': (kpiNewFollowersDeltaPct ?? 0) === 0 || kpiNewFollowersDeltaPct === null
                                            }">
                                                <span *ngIf="kpiNewFollowersDeltaPct !== null">{{ kpiNewFollowersDeltaPct > 0 ? '+' : ''}}{{ kpiNewFollowersDeltaPct }}%</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="px-0 pb-0">
                                        <apx-chart [chart]="chartKpiFollowers.chart" [series]="chartKpiFollowers.series" [colors]="chartKpiFollowers.colors" [stroke]="chartKpiFollowers.stroke"></apx-chart>
                                    </div>
                                </div>
                            </div>

                            <!-- Área: Orgánico vs de pago (estilo Fuse Analytics Visitors vs Page Views) -->
                            <div class="bg-card rounded-2xl shadow overflow-hidden mb-8">
                                <div class="p-6 pb-2">
                                    <div class="text-lg font-semibold">Contenido orgánico vs de pago</div>
                                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mt-4">
                                        <!-- Total -->
                                        <div>
                                            <div class="text-secondary text-xs">Visualizaciones totales</div>
                                            <div class="flex items-baseline space-x-2">
                                                <div class="text-3xl font-bold">{{ formatNumber(organicPaidTotals.total || 0) }}</div>
                                                <div class="text-sm font-medium" [ngClass]="{
                                                    'text-green-600': (organicPaidDeltas.total ?? 0) > 0,
                                                    'text-red-600': (organicPaidDeltas.total ?? 0) < 0,
                                                    'text-secondary': (organicPaidDeltas.total ?? 0) === 0 || organicPaidDeltas.total === null
                                                }">
                                                    <span *ngIf="organicPaidDeltas.total !== null">{{ organicPaidDeltas.total > 0 ? '+' : ''}}{{ organicPaidDeltas.total }}%</span>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- Orgánicas -->
                                        <div>
                                            <div class="text-secondary text-xs">Orgánicas</div>
                                            <div class="flex items-baseline space-x-2">
                                                <div class="text-3xl font-bold">{{ formatNumber(organicPaidTotals.organic || 0) }}</div>
                                                <div class="text-sm font-medium" [ngClass]="{
                                                    'text-green-600': (organicPaidDeltas.organic ?? 0) > 0,
                                                    'text-red-600': (organicPaidDeltas.organic ?? 0) < 0,
                                                    'text-secondary': (organicPaidDeltas.organic ?? 0) === 0 || organicPaidDeltas.organic === null
                                                }">
                                                    <span *ngIf="organicPaidDeltas.organic !== null">{{ organicPaidDeltas.organic > 0 ? '+' : ''}}{{ organicPaidDeltas.organic }}%</span>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- De pago -->
                                        <div>
                                            <div class="text-secondary text-xs">De pago</div>
                                            <div class="flex items-baseline space-x-2">
                                                <div class="text-3xl font-bold">{{ formatNumber(organicPaidTotals.paid || 0) }}</div>
                                                <div class="text-sm font-medium" [ngClass]="{
                                                    'text-green-600': (organicPaidDeltas.paid ?? 0) > 0,
                                                    'text-red-600': (organicPaidDeltas.paid ?? 0) < 0,
                                                    'text-secondary': (organicPaidDeltas.paid ?? 0) === 0 || organicPaidDeltas.paid === null
                                                }">
                                                    <span *ngIf="organicPaidDeltas.paid !== null">{{ organicPaidDeltas.paid > 0 ? '+' : ''}}{{ organicPaidDeltas.paid }}%</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="h-80">
                                    <apx-chart class="h-full w-full flex-auto"
                                        [chart]="chartOrganicPaid.chart"
                                        [series]="chartOrganicPaid.series"
                                        [colors]="chartOrganicPaid.colors"
                                        [dataLabels]="chartOrganicPaid.dataLabels"
                                        [fill]="chartOrganicPaid.fill"
                                        [grid]="chartOrganicPaid.grid"
                                        [legend]="chartOrganicPaid.legend"
                                        [stroke]="chartOrganicPaid.stroke"
                                        [tooltip]="chartOrganicPaid.tooltip"
                                        [xaxis]="chartOrganicPaid.xaxis"
                                        [yaxis]="chartOrganicPaid.yaxis">
                                    </apx-chart>
                                </div>
                            </div>

                            <!-- Tabla publicaciones -->
                            <div class="text-2xl font-semibold tracking-tight mb-2 flex items-center">
                                <span>Así han funcionado tus publicaciones</span>
                                <mat-icon class="ml-2 text-hint cursor-help" [matTooltip]="'Resumen de métricas por publicación: Alcance = personas únicas que vieron el post; Impresiones = veces que se mostró; Views = reproducciones de vídeo/reel; Tiempo medio = segundos promedio de reproducción; Likes/Reacciones, Comentarios y Compartidos son totales por publicación.'" matTooltipPosition="above" [svgIcon]="'heroicons_outline:question-mark-circle'"></mat-icon>
                            </div>
                            <div class="text-secondary mb-4">Rendimiento del contenido</div>
                            <div class="bg-card rounded-2xl shadow overflow-hidden posts-table-wrapper">
                                <table mat-table [dataSource]="dataSource" matSort class="w-full min-w-[960px]">
                                    <ng-container matColumnDef="titulo">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header="title" class="px-6 py-4 text-left" [matTooltip]="'Título y miniatura. Enlace al post en la plataforma.'" matTooltipPosition="above">Título</th>
                                        <td mat-cell *matCellDef="let p" class="px-6 py-4">
                                            <div class="flex items-center space-x-3">
                                                <ng-container *ngIf="p.media_url && !p.media_url.endsWith('.mp4'); else videoThumb">
                                                    <img [src]="p.media_url" class="w-12 h-12 rounded-lg object-cover"/>
                                                </ng-container>
                                                <ng-template #videoThumb>
                                                    <div class="w-12 h-12 rounded-lg bg-gray-200 dark:bg-gray-700 flex items-center justify-center">
                                                        <mat-icon [svgIcon]="'heroicons_outline:play'" class="text-gray-500"></mat-icon>
                                                    </div>
                                                </ng-template>
                                                <div>
                                                    <div class="font-medium line-clamp-1">{{ p.title || '—' }}</div>
                                                    <a *ngIf="p.permalink_url" [href]="p.permalink_url" target="_blank" class="text-primary text-sm">ver publicación</a>
                                                </div>
                                            </div>
                                        </td>
                                    </ng-container>
                                    <ng-container matColumnDef="publicado">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header="published_at" class="px-6 py-4 text-left" [matTooltip]="'Fecha y hora de publicación (zona UTC/servidor).'" matTooltipPosition="above">Publicado</th>
                                        <td mat-cell *matCellDef="let p" class="px-6 py-4">{{ p.published_at | date:'d/M/yyyy' }}</td>
                                    </ng-container>
                                    <ng-container matColumnDef="tipo">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header="post_type" class="px-6 py-4 text-left" [matTooltip]="'Tipo de publicación (foto, video, reel, link, carousel, status). En Facebook usamos status_type/type; en Instagram media_type.'" matTooltipPosition="above">Tipo</th>
                                        <td mat-cell *matCellDef="let p" class="px-6 py-4">{{ mapPostType(p.post_type) }}</td>
                                    </ng-container>
                                    <ng-container matColumnDef="likes">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header="reactions_and_likes" class="px-6 py-4 text-left" [matTooltip]="'Likes / reacciones totales'" matTooltipPosition="above"><mat-icon [svgIcon]="'feather:thumbs-up'" class="text-secondary"></mat-icon></th>
                                        <td mat-cell *matCellDef="let p" class="px-6 py-4">{{ p.reactions_and_likes || 0 }}</td>
                                    </ng-container>
                                    <ng-container matColumnDef="comments">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header="comments_count" class="px-6 py-4 text-left" [matTooltip]="'Número total de comentarios'" matTooltipPosition="above"><mat-icon [svgIcon]="'feather:message-circle'" class="text-secondary"></mat-icon></th>
                                        <td mat-cell *matCellDef="let p" class="px-6 py-4">{{ p.comments_count || 0 }}</td>
                                    </ng-container>
                                    <ng-container matColumnDef="shares">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header="shares" class="px-6 py-4 text-left" [matTooltip]="'Veces que se compartió'" matTooltipPosition="above"><mat-icon [svgIcon]="'feather:share-2'" class="text-secondary"></mat-icon></th>
                                        <td mat-cell *matCellDef="let p" class="px-6 py-4">{{ p.shares_count || 0 }}</td>
                                    </ng-container>
                                    <ng-container matColumnDef="reach">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header="reach" class="px-6 py-4 text-left" [matTooltip]="'Personas únicas que vieron la publicación (reach). FB: post_impressions_unique; IG: reach por post.'" matTooltipPosition="above">Alcance</th>
                                        <td mat-cell *matCellDef="let p" class="px-6 py-4">{{ p.stats?.[0]?.reach || 0 }}</td>
                                    </ng-container>
                                    <ng-container matColumnDef="paidReach">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header="paid_reach" class="px-6 py-4 text-left" [matTooltip]="'Alcance atribuido a anuncios vinculados al post (suma de Ads en el rango seleccionado).'" matTooltipPosition="above">Alcance de pago</th>
                                        <td mat-cell *matCellDef="let p" class="px-6 py-4">{{ p.paid_reach || 0 }}</td>
                                    </ng-container>
                                    <ng-container matColumnDef="views">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header="views" class="px-6 py-4 text-left" [matTooltip]="'Reproducciones de vídeo/reel. IG: views; FB: post_video_views/video_insights.'" matTooltipPosition="above">Views</th>
                                        <td mat-cell *matCellDef="let p" class="px-6 py-4">{{ (p.stats?.[0]?.video_views ?? p.views_count) || 0 }}</td>
                                    </ng-container>
                                    <ng-container matColumnDef="avg">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header="avgWatch" class="px-6 py-4 text-left" [matTooltip]="'Segundos promedio de reproducción del vídeo/reel (si aplica).'" matTooltipPosition="above">Tiempo medio de reproducción</th>
                                        <td mat-cell *matCellDef="let p" class="px-6 py-4">{{ (p.stats?.[0]?.avg_watch_time ?? (p.avg_watch_time_ms ? (p.avg_watch_time_ms/1000) : null)) ? ((p.stats?.[0]?.avg_watch_time || (p.avg_watch_time_ms/1000)) | number:'1.0-0') + 's' : '-' }}</td>
                                    </ng-container>

                                    <tr mat-header-row *matHeaderRowDef="['titulo','publicado','tipo','likes','comments','shares','reach','paidReach','views','avg']"></tr>
                                    <tr mat-row *matRowDef="let row; columns: ['titulo','publicado','tipo','likes','comments','shares','reach','paidReach','views','avg'];"></tr>
                                </table>
                                <div class="p-4 flex justify-center">
                                    <button mat-stroked-button>Ver más</button>
                                </div>
                            </div>
                        </div>
						
						<!-- Loading State -->
						<div *ngIf="loadingMetricas" class="flex items-center justify-center p-16">
							<mat-icon class="animate-spin mr-4" [svgIcon]="'heroicons_outline:arrow-path'"></mat-icon>
							<span>Cargando métricas...</span>
						</div>
						
						<!-- Error State -->
						<div *ngIf="errorMetricas" class="flex items-center justify-center p-16 text-red-600">
							<mat-icon class="mr-4" [svgIcon]="'heroicons_outline:exclamation-triangle'"></mat-icon>
							<span>{{ errorMetricas }}</span>
							<button mat-button (click)="refreshMetricas()" class="ml-4">
								<mat-icon [svgIcon]="'heroicons_outline:arrow-path'"></mat-icon>
								Reintentar
							</button>
						</div>

                        <!-- Oculto: secciones mock posteriores al listado de publicaciones -->
                        <ng-container *ngIf="false">
						
						<!-- Cards de redes sociales principales -->
						<div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                            <div class="text-2xl font-semibold tracking-tight">Redes Sociales</div>
							<div class="text-secondary">Métricas de tus redes sociales</div>
							
							<!-- Facebook Card - DATOS REALES -->
							<div class="bg-card shadow rounded-2xl p-6">
								<div class="flex items-center justify-between mb-4">
									<div>
										<div class="text-lg font-semibold">Facebook</div>
										<div class="text-2xl font-bold text-blue-600">{{ formatNumber(facebookMetrics?.seguidores || 0) }}</div>
										<div class="text-sm text-secondary">seguidores</div>
									</div>
									<mat-icon class="text-blue-500 icon-size-8" [svgIcon]="'heroicons_solid:check'"></mat-icon>
								</div>
								<div class="text-sm">
									<div class="flex justify-between">
										<span>Engagement:</span>
										<span class="font-medium">{{ facebookMetrics?.engagement }}%</span>
									</div>
								</div>
							</div>
							
							<!-- Instagram Card - DATOS REALES -->
							<div class="bg-card shadow rounded-2xl p-6">
								<div class="flex items-center justify-between mb-4">
									<div>
										<div class="text-lg font-semibold">Instagram</div>
										<div class="text-2xl font-bold text-pink-500">{{ formatNumber(instagramMetrics?.seguidores || 0) }}</div>
										<div class="text-sm text-secondary">seguidores</div>
									</div>
									<mat-icon class="text-pink-500 icon-size-8" [svgIcon]="'heroicons_solid:camera'"></mat-icon>
								</div>
								<div class="text-sm">
									<div class="flex justify-between">
										<span>Engagement:</span>
										<span class="font-medium">{{ instagramMetrics?.engagement }}%</span>
									</div>
								</div>
							</div>
							
							<!-- TikTok Card - DATOS REALES -->
							<div class="bg-card shadow rounded-2xl p-6">
								<div class="flex items-center justify-between mb-4">
									<div>
										<div class="text-lg font-semibold">TikTok</div>
										<div class="text-2xl font-bold text-gray-800">{{ formatNumber(tiktokMetrics?.seguidores || 0) }}</div>
										<div class="text-sm text-secondary">seguidores</div>
									</div>
									<mat-icon class="text-gray-800 icon-size-8" [svgIcon]="'heroicons_solid:musical-note'"></mat-icon>
								</div>
								<div class="text-sm">
									<div class="flex justify-between">
										<span>Visualizaciones:</span>
										<span class="font-medium">{{ formatNumber(tiktokMetrics?.visualizaciones || 0) }}</span>
									</div>
								</div>
							</div>
							
							<!-- LinkedIn Card - DATOS REALES -->
							<div class="bg-card shadow rounded-2xl p-6">
								<div class="flex items-center justify-between mb-4">
									<div>
										<div class="text-lg font-semibold">LinkedIn</div>
										<div class="text-2xl font-bold text-blue-700">{{ formatNumber(linkedinMetrics?.seguidores || 0) }}</div>
										<div class="text-sm text-secondary">seguidores</div>
									</div>
									<mat-icon class="text-blue-700 icon-size-8" [svgIcon]="'heroicons_solid:briefcase'"></mat-icon>
								</div>
								<div class="text-sm">
									<div class="flex justify-between">
										<span>Impresiones:</span>
										<span class="font-medium">{{ formatNumber(linkedinMetrics?.impresiones || 0) }}</span>
									</div>
								</div>
							</div>
						</div>
						
						<!-- Sección de estadísticas detalladas -->
						<div>
							<div class="text-2xl font-semibold tracking-tight mb-2">Estadísticas Detalladas</div>
							<div class="text-secondary mb-6">Métricas disponibles por plataforma</div>
							
							<!-- Grid de métricas REALES -->
							<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
								<!-- Engagement Facebook - DATOS REALES -->
								<div class="bg-card shadow rounded-2xl p-6">
									<div class="flex items-center justify-between mb-2">
										<span class="text-secondary text-sm">Engagement Facebook</span>
										<mat-icon class="text-blue-500" [svgIcon]="'heroicons_solid:check'"></mat-icon>
									</div>
									<div class="text-3xl font-bold">{{ facebookMetrics?.engagement }}%</div>
									<div class="text-sm text-blue-500">{{ formatNumber(facebookMetrics?.seguidores || 0) }} seguidores</div>
									<div class="flex flex-auto items-end mt-6">
										<apx-chart *ngIf="datosCargados"
										#facebookChart
										class="flex-auto w-full"
										[height]="200"
										[chart]="chartSeguidoresFacebook.chart"
										[colors]="chartSeguidoresFacebook.colors"
										[dataLabels]="chartSeguidoresFacebook.dataLabels"
										[grid]="chartSeguidoresFacebook.grid"
										[series]="chartSeguidoresFacebook.series"
										[stroke]="chartSeguidoresFacebook.stroke"
										[tooltip]="chartSeguidoresFacebook.tooltip"
										[xaxis]="chartSeguidoresFacebook.xaxis"
										[yaxis]="chartSeguidoresFacebook.yaxis"
										[noData]="chartSeguidoresFacebook.noData">
										</apx-chart>
									</div>
								</div>
								
								<!-- Visualizaciones TikTok - DATOS REALES -->
								<div class="bg-card shadow rounded-2xl p-6">
									<div class="flex items-center justify-between mb-2">
										<span class="text-secondary text-sm">Visualizaciones TikTok</span>
										<mat-icon class="text-gray-800" [svgIcon]="'heroicons_solid:musical-note'"></mat-icon>
									</div>
									<div class="text-3xl font-bold">{{ formatNumber(tiktokMetrics?.visualizaciones || 0) }}</div>
									<div class="text-sm text-gray-600">{{ formatNumber(tiktokMetrics?.seguidores || 0) }} seguidores</div>
									<div class="h-16 mt-4 bg-gradient-to-r from-gray-800/20 to-gray-600/20 rounded-lg"></div>
								</div>
								
								<!-- Impresiones LinkedIn - DATOS REALES -->
								<div class="bg-card shadow rounded-2xl p-6">
									<div class="flex items-center justify-between mb-2">
										<span class="text-secondary text-sm">Impresiones LinkedIn</span>
										<mat-icon class="text-blue-700" [svgIcon]="'heroicons_solid:briefcase'"></mat-icon>
									</div>
									<div class="text-3xl font-bold">{{ formatNumber(linkedinMetrics?.impresiones || 0) }}</div>
									<div class="text-sm text-blue-700">{{ formatNumber(linkedinMetrics?.seguidores || 0) }} seguidores</div>
									<div class="h-16 mt-4 bg-gradient-to-r from-blue-700/20 to-blue-500/20 rounded-lg"></div>
								</div>
							</div>
						</div>
						
						<!-- Sección "Próximamente" para métricas no disponibles -->
						<div>
							<div class="text-2xl font-semibold tracking-tight mb-2">Próximamente</div>
							<div class="text-secondary mb-6">Métricas en desarrollo</div>
							<div class="grid grid-cols-1 md:grid-cols-3 gap-6">
								<!-- Citas desde redes sociales -->
								<div class="bg-card shadow rounded-2xl p-6 opacity-50">
									<div class="flex items-center justify-between mb-2">
										<span class="text-secondary text-sm">Citas desde redes sociales</span>
										<mat-icon class="text-gray-400" [svgIcon]="'heroicons_outline:calendar'"></mat-icon>
									</div>
									<div class="text-3xl font-bold text-gray-400">-</div>
									<div class="text-sm text-gray-400">En desarrollo</div>
									<div class="h-16 mt-4 bg-gray-100 rounded-lg flex items-center justify-center">
										<span class="text-xs text-gray-400">Próximamente</span>
									</div>
								</div>
								
								<!-- Presupuestos aceptados -->
								<div class="bg-card shadow rounded-2xl p-6 opacity-50">
									<div class="flex items-center justify-between mb-2">
										<span class="text-secondary text-sm">Presupuestos aceptados</span>
										<mat-icon class="text-gray-400" [svgIcon]="'heroicons_outline:currency-euro'"></mat-icon>
									</div>
									<div class="text-3xl font-bold text-gray-400">-</div>
									<div class="text-sm text-gray-400">En desarrollo</div>
									<div class="h-16 mt-4 bg-gray-100 rounded-lg flex items-center justify-center">
										<span class="text-xs text-gray-400">Próximamente</span>
									</div>
								</div>
								
								<!-- ROI de publicidad -->
								<div class="bg-card shadow rounded-2xl p-6 opacity-50">
									<div class="flex items-center justify-between mb-2">
										<span class="text-secondary text-sm">ROI de publicidad</span>
										<mat-icon class="text-gray-400" [svgIcon]="'heroicons_outline:chart-bar'"></mat-icon>
									</div>
									<div class="text-3xl font-bold text-gray-400">-</div>
									<div class="text-sm text-gray-400">En desarrollo</div>
									<div class="h-16 mt-4 bg-gray-100 rounded-lg flex items-center justify-center">
										<span class="text-xs text-gray-400">Próximamente</span>
									</div>
								</div>
							</div>
						</div>
                        </ng-container>
					</div>
				</ng-template>
			</mat-tab>

			<!-- Pestaña Web -->
			<mat-tab label="Web">
				<ng-template matTabContent>
					<div class="grid gap-8 pt-8 sm:gap-16 sm:pt-16">
						<div class="flex flex-col items-center justify-center p-16 text-center">
							<mat-icon
								class="icon-size-16 text-hint mb-4"
								[svgIcon]="'heroicons_outline:globe-alt'"></mat-icon>
							<div class="text-2xl font-semibold tracking-tight">
								Métricas Web
							</div>
							<div class="text-secondary mt-2">
								Aquí aparecerán las métricas de tu sitio web
							</div>
						</div>
					</div>
				</ng-template>
			</mat-tab>
			
			<!-- Pestaña Publicidad -->
			<mat-tab label="Publicidad">
				<ng-template matTabContent>
					<div class="grid gap-8 pt-8 sm:gap-16 sm:pt-16">
						<div class="flex flex-col items-center justify-center p-16 text-center">
							<mat-icon
								class="icon-size-16 text-hint mb-4"
								[svgIcon]="'heroicons_outline:megaphone'"></mat-icon>
							<div class="text-2xl font-semibold tracking-tight">
								Métricas de Publicidad
							</div>
							<div class="text-secondary mt-2">
								Aquí aparecerán las métricas de tus campañas publicitarias
							</div>
						</div>
					</div>
				</ng-template>
			</mat-tab>
			
			</mat-tab-group>
		</div>
	</div>
</div>
